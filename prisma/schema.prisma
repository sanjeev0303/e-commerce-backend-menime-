generator client {
  provider        = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum OrderStatus {
  PENDING
  SHIPPED
  DELIVERED
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  name      String
  imageUrl  String?   @default("")
  clerkId   String    @unique
  addresses Address[]
  wishlist  Product[] @relation("UserWishlist")
  cart      Cart?
  orders    Order[]
  reviews   Review[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Address {
  id            String  @id @default(cuid())
  label         String
  fullName      String
  streetAddress String
  city          String
  state         String
  zipCode       String
  phoneNumber   String
  isDefault     Boolean @default(false)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Product {
  id            String   @id @default(cuid())
  name          String
  description   String
  price         Decimal  @db.Decimal(10, 2)
  stock         Int      @default(0)
  category      String
  images        String[]
  averageRating Float    @default(0)
  totalReviews  Int      @default(0)

  wishlistedBy User[]      @relation("UserWishlist")
  cartItems    CartItem[]
  orderItems   OrderItem[]
  reviews      Review[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Cart {
  id      String     @id @default(cuid())
  clerkId String     @unique
  items   CartItem[]

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CartItem {
  id       String @id @default(cuid())
  quantity Int    @default(1)

  cartId String
  cart   Cart   @relation(fields: [cartId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model Order {
  id              String      @id @default(cuid())
  clerkId         String
  shippingAddress Json
  paymentResult   Json?
  totalPrice      Decimal     @db.Decimal(10, 2)
  status          OrderStatus @default(PENDING)
  deliveredAt     DateTime?
  shippedAt       DateTime?

  items   OrderItem[]
  reviews Review[]

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model OrderItem {
  id       String  @id @default(cuid())
  name     String
  price    Decimal @db.Decimal(10, 2)
  quantity Int
  image    String

  orderId String
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id])
}

model Review {
  id     String @id @default(cuid())
  rating Int

  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  orderId String
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
